-- Services
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- Clear existing effects
for _, effect in pairs(Lighting:GetChildren()) do
   if effect:IsA("PostEffect") then
       effect:Destroy()
   end
end

-- Variables
local enabled = false
local lastUpdate = 0
local updateInterval = 0.1

-- Configure lighting
Lighting.Technology = Enum.Technology.Future
Lighting.GlobalShadows = true
Lighting.ShadowSoftness = 0.05
Lighting.ExposureCompensation = 0.25
Lighting.EnvironmentDiffuseScale = 1.2
Lighting.EnvironmentSpecularScale = 1.4
Lighting.GeographicLatitude = 45

-- Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "RTXGui"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 300)
frame.Position = UDim2.new(0.85, 0, 0.5, -150)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
frame.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = frame

local title = Instance.new("TextLabel")
title.Text = "RTX Settings"
title.Size = UDim2.new(1, 0, 0.15, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 20
title.Font = Enum.Font.GothamBold
title.Parent = frame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0.8, 0, 0.15, 0)
toggleBtn.Position = UDim2.new(0.1, 0, 0.2, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 120, 200)
toggleBtn.Text = "Enable RTX"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.Parent = frame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleBtn

-- Create effects
local effects = {
   SunRays = Instance.new("SunRaysEffect"),
   Bloom = Instance.new("BloomEffect"),
   ColorCorrection = Instance.new("ColorCorrectionEffect"),
   Atmosphere = Instance.new("Atmosphere"),
   DepthOfField = Instance.new("DepthOfFieldEffect"),
   Blur = Instance.new("BlurEffect"),
   ChromaticAberration = Instance.new("ChromaticAberrationEffect")
}

-- Configure effects
effects.SunRays.Intensity = 0.1
effects.SunRays.Spread = 1

effects.Bloom.Intensity = 1.5
effects.Bloom.Size = 45
effects.Bloom.Threshold = 1.0

effects.ColorCorrection.Brightness = 0.2
effects.ColorCorrection.Contrast = 0.6
effects.ColorCorrection.Saturation = 0.8
effects.ColorCorrection.TintColor = Color3.fromRGB(255, 255, 253)

effects.Atmosphere.Density = 0.45
effects.Atmosphere.Offset = 0.35
effects.Atmosphere.Color = Color3.fromRGB(220, 220, 225)
effects.Atmosphere.Decay = Color3.fromRGB(115, 120, 135)
effects.Atmosphere.Glare = 0.6
effects.Atmosphere.Haze = 2.4

effects.DepthOfField.FarIntensity = 0.15
effects.DepthOfField.NearIntensity = 0.75
effects.DepthOfField.FocusDistance = 0.05

effects.Blur.Size = 3

effects.ChromaticAberration.Intensity = 0.2

for _, effect in pairs(effects) do
   effect.Parent = Lighting
   effect.Enabled = false
end

-- Themes
local themes = {
   Default = {
       SunraysIntensity = 0.09,
       BloomIntensity = 1.3,
       Brightness = 2.5,
       Ambient = Color3.fromRGB(110, 110, 115),
       AtmosphereColor = Color3.fromRGB(230, 230, 235),
       ReflectanceBoost = 0.35
   },
   Night = {
       SunraysIntensity = 0.04,
       BloomIntensity = 1.4,
       Brightness = 0.3,
       Ambient = Color3.fromRGB(30, 30, 45),
       AtmosphereColor = Color3.fromRGB(40, 40, 60),
       ReflectanceBoost = 0.4
   },
   Sunset = {
       SunraysIntensity = 0.1,
       BloomIntensity = 1.3,
       Brightness = 2.0,
       Ambient = Color3.fromRGB(255, 170, 120),
       AtmosphereColor = Color3.fromRGB(255, 200, 160),
       ReflectanceBoost = 0.35
   },
   Winter = {
       SunraysIntensity = 0.03,
       BloomIntensity = 1.2,
       Brightness = 2.8,
       Ambient = Color3.fromRGB(210, 230, 255),
       AtmosphereColor = Color3.fromRGB(230, 240, 255),
       ReflectanceBoost = 0.45
   }
}

-- Create theme buttons
local yOffset = 0.4
for themeName, _ in pairs(themes) do
   local themeBtn = Instance.new("TextButton")
   themeBtn.Size = UDim2.new(0.8, 0, 0.12, 0)
   themeBtn.Position = UDim2.new(0.1, 0, yOffset, 0)
   themeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
   themeBtn.Text = themeName
   themeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
   themeBtn.Font = Enum.Font.GothamBold
   themeBtn.Parent = frame
   
   local btnCorner = Instance.new("UICorner")
   btnCorner.CornerRadius = UDim.new(0, 6)
   btnCorner.Parent = themeBtn
   
   themeBtn.MouseButton1Click:Connect(function()
       if enabled then
           local theme = themes[themeName]
           effects.SunRays.Intensity = theme.SunraysIntensity
           effects.Bloom.Intensity = theme.BloomIntensity
           Lighting.Brightness = theme.Brightness
           Lighting.Ambient = theme.Ambient
           effects.Atmosphere.Color = theme.AtmosphereColor
           
           -- Update materials
           for _, obj in pairs(workspace:GetDescendants()) do
               if obj:IsA("BasePart") then
                   obj.Reflectance = obj.Reflectance * theme.ReflectanceBoost
               end
           end
       end
   end)
   
   yOffset = yOffset + 0.15
end

-- Material enhancement function
local function enhanceMaterials()
   for _, obj in pairs(workspace:GetDescendants()) do
       if obj:IsA("BasePart") then
           if obj.Material == Enum.Material.Glass then
               obj.Reflectance = 0.8
               obj.Transparency = 0.5
           else
               obj.Reflectance = 0.3
           end
           obj.Material = Enum.Material.SmoothPlastic
           obj.CastShadow = true
           
           -- Add reflection probe
           if not obj:FindFirstChild("ReflectionProbe") then
               local probe = Instance.new("ReflectionProbe")
               probe.Parent = obj
               probe.Size = obj.Size * 1.5
               probe.Resolution = 512
               probe.RefreshRate = 60
           end
           
           -- Add surface lighting
           if not obj:FindFirstChild("SurfaceLight") then
               local surfaceLight = Instance.new("SurfaceLight")
               surfaceLight.Parent = obj
               surfaceLight.Brightness = 2
               surfaceLight.Range = 15
           end
       end
   end
end

-- Toggle RTX
toggleBtn.MouseButton1Click:Connect(function()
   enabled = not enabled
   toggleBtn.Text = enabled and "Disable RTX" or "Enable RTX"
   toggleBtn.BackgroundColor3 = enabled and Color3.fromRGB(200, 40, 40) or Color3.fromRGB(40, 120, 200)
   
   if enabled then
       enhanceMaterials()
       
       -- Enable effects
       for _, effect in pairs(effects) do
           effect.Enabled = true
       end
       
       -- Apply default theme
       local theme = themes.Default
       effects.SunRays.Intensity = theme.SunraysIntensity
       effects.Bloom.Intensity = theme.BloomIntensity
       Lighting.Brightness = theme.Brightness
       Lighting.Ambient = theme.Ambient
       effects.Atmosphere.Color = theme.AtmosphereColor
       
   else
       -- Disable effects
       for _, effect in pairs(effects) do
           effect.Enabled = false
       end
       
       -- Reset lighting
       Lighting.Brightness = 1
       Lighting.Ambient = Color3.fromRGB(127, 127, 127)
   end
end)

-- Dynamic updates
RunService.Heartbeat:Connect(function()
   if enabled and tick() - lastUpdate >= updateInterval then
       -- Update reflection values
       for _, obj in pairs(workspace:GetDescendants()) do
           if obj:IsA("BasePart") then
               obj.Reflectance = math.clamp(
                   obj.Reflectance + math.sin(tick()) * 0.01,
                   0.2, 0.8
               )
           end
       end
       
       -- Update time of day
       Lighting.ClockTime = (Lighting.ClockTime + 0.02) % 24
       
       lastUpdate = tick()
   end
end)

-- Set graphics quality
settings().Rendering.QualityLevel = 21
settings().Rendering.GraphicsMode = 2

-- Parent GUI to PlayerGui
local player = game.Players.LocalPlayer
gui.Parent = player:WaitForChild("PlayerGui")
