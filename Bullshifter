local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse() 
local Camera = workspace.CurrentCamera

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlingGUI"
ScreenGui.Parent = game:GetService("CoreGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 200, 0, 100)
Frame.Position = UDim2.new(0.5, -100, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Text = "Click Fling"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = Frame

local Toggle = Instance.new("TextButton")
Toggle.Size = UDim2.new(0.8, 0, 0, 40)
Toggle.Position = UDim2.new(0.1, 0, 0.5, -20)
Toggle.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
Toggle.Text = "DISABLED"
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 14
Toggle.Parent = Frame

-- GUI Styling
local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 6)
Corner.Parent = Frame

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 6)
ButtonCorner.Parent = Toggle

-- Mobile Dragging
local dragging = false
local dragInput
local dragStart
local startPos

local function updateDrag(input)
   local delta = input.Position - dragStart
   Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Frame.InputBegan:Connect(function(input)
   if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
       dragging = true
       dragStart = input.Position
       startPos = Frame.Position
       input.Changed:Connect(function()
           if input.UserInputState == Enum.UserInputState.End then
               dragging = false
           end
       end)
   end
end)

Frame.InputChanged:Connect(function(input)
   if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
       dragInput = input
   end
end)

UserInputService.InputChanged:Connect(function(input)
   if dragging and (input == dragInput) then
       updateDrag(input)
   end
end)

-- Fling System
local Enabled = false
local CurrentlyFlinging = false
local LastFlingTime = 0
local FlingForce = 1000000

-- Optimization variables
local LastUpdateTime = 0
local UpdateInterval = 0.1 -- Adjust for performance

local function startFling(target)
   if not Enabled or CurrentlyFlinging or not target.Character then return end
   
   local character = LocalPlayer.Character
   if not character then return end
   
   local humanoid = character:FindFirstChild("Humanoid")
   local rootPart = character:FindFirstChild("HumanoidRootPart")
   local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
   
   if not humanoid or not rootPart or not targetRoot then return end
   
   CurrentlyFlinging = true
   LastFlingTime = tick()
   
   -- Create connection for continuous fling
   local flingConnection
   flingConnection = RunService.Heartbeat:Connect(function()
       local currentTime = tick()
       
       -- Performance optimization
       if currentTime - LastUpdateTime < UpdateInterval then return end
       LastUpdateTime = currentTime
       
       if not Enabled or not target.Character or not target.Character:FindFirstChild("HumanoidRootPart") then
           flingConnection:Disconnect()
           CurrentlyFlinging = false
           return
       end
       
       -- Set extreme velocity
       rootPart.AssemblyLinearVelocity = Vector3.new(FlingForce, FlingForce, FlingForce)
       rootPart.AssemblyAngularVelocity = Vector3.new(FlingForce, FlingForce, FlingForce)
       rootPart.CFrame = targetRoot.CFrame
       
       -- Stop if target is too far (likely flung off)
       if (targetRoot.Position - rootPart.Position).Magnitude > 150 then
           flingConnection:Disconnect()
           CurrentlyFlinging = false
       end
   end)
end

Toggle.MouseButton1Click:Connect(function()
   Enabled = not Enabled
   Toggle.BackgroundColor3 = Enabled and Color3.fromRGB(50, 255, 50) or Color3.fromRGB(255, 50, 50)
   Toggle.Text = Enabled and "ENABLED" or "DISABLED"
   
   if not Enabled then
       CurrentlyFlinging = false
   end
end)

-- Click/Touch Detection
Mouse.Button1Down:Connect(function()
   if not Enabled then return end
   
   local target = Mouse.Target
   if target then
       local player = Players:GetPlayerFromCharacter(target.Parent)
       if player and player ~= LocalPlayer then
           startFling(player)
       end
   end
end)

UserInputService.TouchTap:Connect(function(touches)
   if not Enabled then return end
   
   local ray = Camera:ScreenPointToRay(touches[1].Position.X, touches[1].Position.Y)
   local raycastResult = workspace:Raycast(ray.Origin, ray.Direction * 1000)
   
   if raycastResult and raycastResult.Instance then
       local player = Players:GetPlayerFromCharacter(raycastResult.Instance.Parent)
       if player and player ~= LocalPlayer then
           startFling(player)
       end
   end
end)
