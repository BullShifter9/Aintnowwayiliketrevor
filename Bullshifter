-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")

-- Constants for prediction
local PREDICTION_SETTINGS = {
    BASE_MULTIPLIER = 0.15,
    VERTICAL_MULTIPLIER = 0.35,
    MAX_DISTANCE = 100,
    MIN_VELOCITY = 0.1,
    GRAVITY_COMPENSATION = 0.7,
    PING_MULTIPLIER = 1.2,
    ACCELERATION_WEIGHT = 0.8,
    DIRECTION_WEIGHT = 1.2,
    JUMP_PREDICTION = 0.4,
    VELOCITY_DAMPING = 0.85
}

-- Create ScreenGui with protection
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = game:GetService("HttpService"):GenerateGUID(false)
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global

-- Protection
if syn then
    syn.protect_gui(ScreenGui)
end

ScreenGui.Parent = game:GetService("CoreGui")

-- Create loading frame with blur effect
local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.new(1, 0, 1, 0)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
LoadingFrame.BackgroundTransparency = 0.3
LoadingFrame.Parent = ScreenGui

-- Add blur effect
local BlurEffect = Instance.new("BlurEffect")
BlurEffect.Size = 0
BlurEffect.Parent = Lighting

-- Create gradient
local UIGradient = Instance.new("UIGradient")
UIGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 30)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(40, 40, 40)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 30))
})
UIGradient.Parent = LoadingFrame

-- Enhanced loading circle creation
local function createLoadingCircle(size, speed, offset, color)
    local circleContainer = Instance.new("Frame")
    circleContainer.Size = UDim2.new(0, size, 0, size)
    circleContainer.Position = UDim2.new(0.5, -size/2, 0.5, -size/2)
    circleContainer.BackgroundTransparency = 1
    circleContainer.Parent = LoadingFrame
    
    local circle = Instance.new("ImageLabel")
    circle.Size = UDim2.new(1, 0, 1, 0)
    circle.BackgroundTransparency = 1
    circle.Image = "rbxassetid://4965945816"
    circle.ImageColor3 = color or Color3.fromRGB(255, 255, 255)
    circle.ImageTransparency = 0.2
    circle.Parent = circleContainer
    
    -- Add glow effect
    local glow = Instance.new("ImageLabel")
    glow.Size = UDim2.new(1.2, 0, 1.2, 0)
    glow.Position = UDim2.new(-0.1, 0, -0.1, 0)
    glow.BackgroundTransparency = 1
    glow.Image = "rbxassetid://4965945816"
    glow.ImageColor3 = color or Color3.fromRGB(255, 255, 255)
    glow.ImageTransparency = 0.7
    glow.Parent = circle
    
    -- Animate both rotation and pulse
    local rotation = offset or 0
    spawn(function()
        while LoadingFrame.Visible do
            rotation = rotation + speed
            circleContainer.Rotation = rotation
            
            -- Pulse animation
            local pulseSize = math.sin(tick() * 2) * 0.1 + 1
            circle.Size = UDim2.new(pulseSize, 0, pulseSize, 0)
            glow.Size = UDim2.new(pulseSize * 1.2, 0, pulseSize * 1.2, 0)
            
            task.wait()
        end
    end)
    
    return circleContainer
end

-- Create loading circles with different colors
local circle1 = createLoadingCircle(100, 2, 0, Color3.fromRGB(255, 100, 100))
local circle2 = createLoadingCircle(80, -3, 45, Color3.fromRGB(100, 255, 100))
local circle3 = createLoadingCircle(60, 4, 90, Color3.fromRGB(100, 100, 255))

-- Create animated loading text
local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(0, 200, 0, 50)
LoadingText.Position = UDim2.new(0.5, -100, 0.6, -25)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "Loading MM2 Helper..."
LoadingText.TextColor3 = Color3.fromRGB(255, 255, 255)
LoadingText.TextSize = 20
LoadingText.Font = Enum.Font.GothamBold
LoadingText.Parent = LoadingFrame
